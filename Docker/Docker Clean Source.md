## آزاد سازی منابع داکر

در حالت کلی، استفاده مداوم از داکر و ایجاد تعداد زیادی از کانتینرهای متوقف‌شده یا ایمیج‌های غیرفعال می‌تواند منابع سیستم شما را اشغال کند. در ادامه، به بررسی چندین سناریو برای پاک‌سازی و بهینه‌سازی منابع داکر خواهیم پرداخت.

---

### **1. نمایش و بررسی وضعیت موجودیت‌ها در داکر**

قبل از پاک‌سازی، باید وضعیت کانتینرهای فعال، متوقف‌شده، ایمیج‌ها، وولوم‌ها، و شبکه‌های داکر را بررسی کنید:

#### **نمایش کانتینرهای فعال و متوقف‌شده:**

```bash
docker ps -a
```

#### **نمایش تمام ایمیج‌ها:**

```bash
docker images
```

#### **نمایش وولوم‌های داکر:**

```bash
docker volume ls
```

#### **نمایش شبکه‌های داکر:**

```bash
docker network ls
```

#### **بررسی استفاده از فضای دیسک:**

```bash
docker system df
```

---

### **2. پاک‌سازی کانتینرهای متوقف‌شده**

کانتینرهای متوقف‌شده می‌توانند فضا و منابع سیستم را اشغال کنند. می‌توانید آن‌ها را حذف کنید:

#### **حذف همه کانتینرهای متوقف‌شده:**

```bash
docker container prune
```

#### **حذف یک کانتینر خاص (بر اساس ID یا نام):**

```bash
docker rm <container_id>
```

#### **حذف تمام کانتینرهای متوقف‌شده (دستی):**

```bash
docker ps -aq --filter "status=exited" | xargs docker rm
```

---

### **3. پاک‌سازی ایمیج‌های بدون استفاده**

ایمیج‌هایی که به کانتینری متصل نیستند می‌توانند فضا را اشغال کنند:

#### **حذف ایمیج‌های بدون استفاده:**

```bash
docker image prune -a
```

#### **حذف یک ایمیج خاص (بر اساس ID):**

```bash
docker rmi <image_id>
```

#### **حذف ایمیج‌های معلق (dangling images):**

ایمیج‌های معلق، ایمیج‌هایی هستند که توسط هیچ کانتینری استفاده نمی‌شوند:

```bash
docker image prune
```

---

### **4. پاک‌سازی وولوم‌های بدون استفاده**

وولوم‌های داکر می‌توانند داده‌های زیادی را ذخیره کنند و فضا را اشغال کنند:

#### **حذف وولوم‌های بدون استفاده:**

```bash
docker volume prune
```

#### **حذف یک وولوم خاص (بر اساس نام):**

```bash
docker volume rm <volume_name>
```

---

### **5. پاک‌سازی شبکه‌های بدون استفاده**

شبکه‌های داکری که به کانتینری متصل نیستند می‌توانند حذف شوند:

#### **حذف شبکه‌های بدون استفاده:**

```bash
docker network prune
```

#### **حذف یک شبکه خاص (بر اساس نام):**

```bash
docker network rm <network_name>
```

---

### **6. پاک‌سازی تمام موجودیت‌های بدون استفاده**

اگر مایلید که همه موجودیت‌های داکر (کانتینرها، ایمیج‌ها، وولوم‌ها، شبکه‌ها) که به طور فعال استفاده نمی‌شوند را حذف کنید، می‌توانید از دستور زیر استفاده کنید:

#### **پاک‌سازی عمومی:**

```bash
docker system prune -a
```

> **توجه:** این دستور تمام ایمیج‌ها، کانتینرهای متوقف‌شده، وولوم‌ها، و شبکه‌های بدون استفاده را حذف می‌کند. قبل از اجرای آن، مطمئن شوید که داده‌های مهم شما پشتیبان‌گیری شده‌اند.

---

### **7. مدیریت فضای دیسک داکر**

 some cases, Docker may still consume disk space even after cleaning up containers and images. To address this, you can manually clean up the Docker storage directory:

#### **نمایش محل ذخیره‌سازی داکر:**

```bash
docker info | grep "Docker Root Dir"
```

#### **حذف فایل‌های موقت داکر:**

```bash
sudo rm -rf /var/lib/docker/containers/* /var/lib/docker/volumes/*
```

> **توجه:** این عملیات خطرناک است و تنها باید انجام شود اگر مطمئن هستید که هیچ داده مهمی وجود ندارد.

---

### **8. استفاده از ابزارهای مدیریت داکر**

برای مدیریت بهتر داکر، می‌توانید از ابزارهایی مثل `docker-compose` یا اسکریپت‌های خودکار استفاده کنید. به عنوان مثال، می‌توانید یک اسکریپت بنویسید که به طور متناوب موجودیت‌های داکر را پاک کند.

#### **مثال اسکریپت پاک‌سازی:**

```bash
#!/bin/bash

echo "Pruning unused Docker resources..."
docker container prune -f
docker image prune -a -f
docker volume prune -f
docker network prune -f

echo "Cleanup complete."
```

---

### **9. بهینه‌سازی استفاده از داکر**

برای جلوگیری از اشغال منابع در آینده، موارد زیر را در نظر بگیرید:

- **استفاده از نسخه‌های جدید داکر:** نسخه‌های جدید داکر بهینه‌ترین استراتژی‌های مدیریت منابع را ارائه می‌دهند.
- **پیکربندی ذخیره‌سازی داکر:** با تنظیم اندازه حداکثر فضای دیسک برای داکر، می‌توانید از اشغال بیش از حد فضا جلوگیری کنید.
- **استفاده از Docker Compose:** برای مدیریت بهتر محیط‌ها و منابع.

---

### **نتیجه‌گیری**

با استفاده از روش‌های فوق، می‌توانید منابع داکر خود را بهینه‌سازی کرده و عملکرد سیستم را بهبود بخشید. اگر همچنان مشکل کندی در سیستم وجود دارد، ممکن است مشکل از عوامل دیگری مانند پیکربندی سیستم یا استفاده نادرست از منابع باشد. در این صورت، لطفاً اطلاعات بیشتری دربارهٔ سیستم خود ارائه دهید تا بتوانم کمک بیشتری به شما بکنم.
